# Frontend Deployment Guide

This guide covers automated deployment of the Zero Trust Frontend application using Docker Compose.

## 🚀 Quick Start

### Production Deployment
```bash
# Deploy everything including frontend
./scripts/deploy.sh

# Or deploy frontend only
./scripts/setup-frontend.sh prod
```

### Development Deployment
```bash
# Deploy in development mode with hot reloading
./scripts/deploy-dev.sh

# Or deploy frontend in dev mode only
./scripts/setup-frontend.sh dev
```

> **Note:** In development mode, all services (Frontend, API Gateway, OPA, Keycloak, Backend) use HTTP only. No HTTPS is used in dev for easier local testing.

## 📋 Prerequisites

- Docker and Docker Compose installed
- Node.js 18+ (for local development)
- SSL certificates (auto-generated by setup scripts)

## 🏗️ Architecture

### Production Setup
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   Nginx         │    │   React App     │
│   (Port 8080)   │───▶│   (SSL/TLS)     │───▶│   (Built)       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### Development Setup
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   React Dev     │    │   Source Code   │
│   (Port 3000)   │───▶│   Server        │───▶│   (Mounted)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🔧 Configuration

### Environment Variables

The frontend uses these environment variables:

```bash
# API Configuration
REACT_APP_API_URL=https://localhost:8443    # Production
REACT_APP_API_URL=http://localhost:3000     # Development

# Keycloak Configuration
REACT_APP_KEYCLOAK_URL=http://localhost:8080

# Build Configuration
NODE_ENV=production                          # Production
NODE_ENV=development                         # Development
```

## Docker Compose Files

The frontend deployment uses Docker Compose with multiple configuration files:

- `docker-compose.yml` - Main services + production frontend

## 🐳 Docker Images

### Production Image
- **Base**: `node:18-alpine` (build stage)
- **Runtime**: `nginx:alpine` (production stage)
- **Features**: Multi-stage build, optimized for production

### Development Image
- **Base**: `node:18-alpine`
- **Features**: Hot reloading, source mounting, development server

## 📦 Build Process

### Production Build
1. Install dependencies (`npm ci --only=production`)
2. Build React app (`npm run build`)
3. Copy to nginx container
4. Configure SSL and security headers

### Development Build
1. Install all dependencies (`npm install`)
2. Start development server (`npm start`)
3. Mount source code for hot reloading

## 🔒 Security Features

### SSL/TLS Configuration
- Automatic certificate mounting
- HTTPS redirect
- Security headers (CSP, HSTS, XSS protection)

### Security Headers
```nginx
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Content-Security-Policy: default-src 'self'; ...
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

### Rate Limiting
- API requests: 10 requests/second
- Login attempts: 5 requests/minute

## 🚀 Deployment Commands

### Full Stack Deployment
```bash
# Production (recommended)
./scripts/deploy.sh

# Development
./scripts/deploy-dev.sh
```

### Frontend Only
```bash
# Production
./scripts/setup-frontend.sh prod

# Development
./scripts/setup-frontend.sh dev
```

### Manual Docker Compose
```bash
# Production
docker-compose -f docker-compose.yml up -d frontend-app

# Development
docker-compose -f docker-compose.yml up -d frontend-dev
```

## 🔍 Monitoring & Debugging

### Health Checks
```bash
# Check frontend health
curl -f -k https://localhost/health

# Check container status
docker ps | grep frontend
```

### Logs
```bash
# Production logs
docker-compose -f docker-compose.yml logs frontend-app

# Development logs
docker-compose -f docker-compose.yml logs frontend-dev

# Follow logs
docker-compose -f docker-compose.yml logs -f frontend-app
```

### Debugging
```bash
# Access container shell
docker exec -it $(docker ps -q --filter "name=frontend") sh

# Check nginx configuration
docker exec -it $(docker ps -q --filter "name=frontend") nginx -t

# View nginx logs
docker exec -it $(docker ps -q --filter "name=frontend") tail -f /var/log/nginx/error.log
```

## 🔄 Development Workflow

### Local Development
```bash
# Start development environment
./scripts/deploy-dev.sh

# Make changes to source code
# Changes are automatically reflected (hot reloading)

# View changes at http://localhost:3000
```

### Production Testing
```bash
# Deploy to production
./scripts/deploy.sh

# Test production build
# Access at https://localhost:8080
```

## 🛠️ Customization

### Adding New Dependencies
1. Add to `package.json`
2. Rebuild Docker image: `docker-compose build frontend-app`

### Modifying Nginx Configuration
1. Edit `nginx.conf`
2. Rebuild and restart: `docker-compose up -d --build frontend-app`

### Environment-Specific Configs
Create environment-specific compose files:
```yaml
# docker-compose.frontend-staging.yml
version: '3.8'
services:
  frontend-app:
    environment:
      - REACT_APP_API_URL=https://staging-api.example.com
```

## 📊 Performance Optimization

### Production Optimizations
- Multi-stage Docker build
- Nginx caching for static assets
- Gzip compression
- Optimized React build

### Development Optimizations
- Hot reloading
- Source mounting
- Fast refresh
- Development server

## 🔧 Troubleshooting

### Common Issues

#### Frontend Not Loading
```bash
# Check if container is running
docker ps | grep frontend

# Check logs
docker-compose logs frontend-app

# Check health
curl -f -k https://localhost/health
```

#### SSL Certificate Issues
```bash
# Regenerate certificates
./scripts/generate-certs.sh

# Restart frontend
docker-compose restart frontend-app
```

#### Hot Reloading Not Working
```bash
# Check volume mounts
docker inspect $(docker ps -q --filter "name=frontend-dev")

# Restart development container
docker-compose -f docker-compose.yml restart frontend-dev
```

#### API Connection Issues
```bash
# Check API URL configuration
docker exec -it $(docker ps -q --filter "name=frontend") env | grep REACT_APP

# Verify backend is running
curl -f http://localhost:3000/health
```

## 📚 Additional Resources

- [React Documentation](https://reactjs.org/docs/)
- [Material-UI Documentation](https://mui.com/)
- [Nginx Configuration](https://nginx.org/en/docs/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)

## 🆘 Support

For issues and questions:
1. Check the troubleshooting section
2. Review logs and health checks
3. Verify configuration files
4. Create an issue in the repository 